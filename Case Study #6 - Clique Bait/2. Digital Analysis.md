### 2. Digital Analysis

**1. How many users are there?**

````sql
select 
	count (distinct user_id) as total_users
from 
	users 
````
Answer:
| count |
|-------|
| 500   |

***

**2. How many cookies does each user have on average?**

````sql
with count_table as (
select
	user_id,
	count(cookie_id) as cookie_count
from 
	users
group by
	user_id
)

select 
	round(avg(cookie_count),0) as avg_cookie
from
	count_table
````
Answer:
| avg_cookie |
|------------|
|          4 |

***

**3. What is the unique number of visits by all users per month?**

````sql
select
	extract(month from event_time) as month_number,
	count(distinct visit_id) as visit_count -- unique means distinct 
from 
	events 
group by
	extract(month from event_time) 
````
Answer:
| month_number | visit_count |
|--------------|-------------|
|            1 |         876 |
|            2 |        1488 |
|            3 |         916 |
|            4 |         248 |
|            5 |          36 |

***

**4. What is the number of events for each event type?**

````sql
select
	event_type,
	count(event_type) as event_count -- unique means distinct 
from 
	events 
group by
	event_type 
order by
	event_type
````
Answer:
| event_type | event_count |
|------------|-------------|
|          1 |       20928 |
|          2 |        8451 |
|          3 |        1777 |
|          4 |         876 |
|          5 |         702 |

***

**5. What is the percentage of visits which have a purchase event?**

````sql
select
	round(count(distinct e.visit_id)::numeric*100/total_visits.total_count,2) as purchase_percentage -- finding unique visits have 'purchase'
from 
	events e
join
	event_identifier ei on e.event_type = ei.event_type 
cross join
	(select count(distinct visit_id) as total_count from events) as total_visits -- cross join to get the total count for all events 
where
	ei.event_name = 'Purchase'
group by 
	total_visits.total_count 

````
Answer:
| purchase_percentage |
|---------------------|
|                49.86|

***

**6. What is the percentage of visits which view the checkout page but do not have a purchase event?**

***

**7. What are the top 3 pages by number of views?**

***

**8. What is the number of views and cart adds for each product category?**

***

**9. What are the top 3 products by purchases?**

